<app-filter-panel>
  <div sort-buttons>
    <app-button
      label="ASC"
      buttonType="primary"
      [isLoading]="isLoading()"
      (buttonClick)="sort('asc')"
    ></app-button>
    <app-button
      label="Desc"
      buttonType="outline"
      [isLoading]="isLoading()"
      (buttonClick)="sort('desc')"
    ></app-button>
  </div>

  <div toggle-price>
    <app-button
      label="Show Price"
      buttonType="success"
      [isLoading]="isLoading()"
      (buttonClick)="toggle()"
    ></app-button>
  </div>

  <div filter-input class="w-50">
    <input
      type="text"
      class="form-control form-control-sm rounded"
      id="floatingInputGroup1"
      [(ngModel)]="filterText"
      placeholder="Search"
    />
  </div>
</app-filter-panel>

@if (isLoading()) {
  <p class="text-center mt-3">Loading...</p>
} @else {
  <div class="container-fluid text-center mt-5">
    <div class="row row-cols-1 row-cols-md-6 g-5">
      @for (item of FilteredAndSortedProducts(); track item) {
        <div class="col">
          <app-card>
            <div class="card-img-top" style="height: 150px;">
              <img
                src="{{ item.image }}"
                class="card-img-top"
                alt="{{ item.title }}"
                style="max-height: 100%; max-width: 100%; object-fit: contain;"
              />
            </div>
            <div class="card-body d-flex flex-column">
              <h5
                class="card-title"
                style="flex-grow: 1;"
                [routerLink]="['/product', item.id]"
              >
                {{ item.title }}
              </h5>
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">{{ item.category }}</li>
              @if (isPriceVisible()) {
                <li class="list-group-item">${{ item.price }}</li>
              }
            </ul>
            <div class="card-body d-flex justify-content-between align-items-center">
              <app-button
                label="Show Details"
                class="me-1 flex-fill"
                data-bs-toggle="modal"
                data-bs-target="#exampleModal"
                buttonType="outline"
                [isLoading]="VisibleProductId() === item.id"
                (buttonClick)="toggle2(item.id, item)"
              ></app-button>
              <app-button
                label="UsuÅ„"
                buttonType="danger"
                (buttonClick)="deleteProduct(item.id)"
              ></app-button>
              <app-button
                label="Buy now!"
                buttonType="success"
                (buttonClick)="onAddButtonCliced(item)"
              ></app-button>
            </div>
          </app-card>
        </div>
      }
    </div>
  </div>
}


<app-modal>
  <div modal-header>
    <h5 class="modal-title">Product Details</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>
  <div modal-body>
    @if (selectedProduct()) {
      <img
        src="{{ selectedProduct()?.image }}"
        class="card-img-top"
        alt="{{ selectedProduct()?.title }}"
        style="max-height: 100%; max-width: 100%; object-fit: contain;"
      />
      <p>
        <strong>Product Title:</strong> {{ selectedProduct()?.title }}
      </p>
      <p><strong>Price:</strong> {{ selectedProduct()?.price }}$</p>
      <p>
        <strong>Description:</strong> {{ selectedProduct()?.description }}
      </p>
    }
  </div>
  <div modal-footer>
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
    <button type="button" class="btn btn-primary">Save changes</button>
  </div>
</app-modal>

<app-footer 
  [linkUrl]="linkUrl" 
  [linkText]="linkText" 
  [companyName]="companyName">
</app-footer>
